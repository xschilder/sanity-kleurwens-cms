// sanity.config.ts (lub .js)

import { defineConfig } from 'sanity'
import { deskTool } from 'sanity/desk'
import {structureTool} from 'sanity/structure'
import {visionTool} from '@sanity/vision'
import {schemaTypes} from './schemaTypes'
// ... inne importy

// Lista wszystkich singletonów w projekcie
const singletonTypes = new Set([
  'privacyPolicy',
  'terms',                    // jeśli planujesz
  'cookies',                  // jeśli planujesz
  'guaranteeBlock',
  'quickDecisionMotivation',
  // dodaj inne singletons, które już masz
])

const singletonActions = new Set(['update', 'publish', 'discardChanges'])  // ← tylko te, które chcesz zostawić

export default defineConfig({
  name: 'default',
  title: 'kleurwens-cms-2026',

  projectId: '9s59sp8p',
  dataset: 'production',

  plugins: [structureTool(), visionTool()],

  schema: {
    types: schemaTypes,
  },

  schema: {
    types: schemaTypes,

    // 1. Ukryj możliwość tworzenia nowego dokumentu typu privacyPolicy
    templates: (prev) => prev.filter(
      (template) => !singletonTypes.has(template.schemaType)
    ),
  },

  document: {
    // 2. Dla singletonów zostaw tylko wybrane akcje (usuń create, delete, duplicate itp.)
    actions: (prev, context) => {
      if (singletonTypes.has(context.schemaType)) {
        return prev.filter(
          (action) => action && singletonActions.has(action.action)
        )
      }
      return prev
    },
  },
})
